## AI-generated notice

This file was AI-generated and may contain errors. Please verify against source code and hardware behavior.
- Date: 2025-12-30
- Model: GPT-5.2
- Maintenance: If you change firmware behavior or host protocol, please update this document.

## Purpose

Firmware for the **Strobe Imaging Module** PIC controller. It receives timing/configuration commands over SPI and produces strobe timing behavior for synchronized imaging (including a hardware-trigger variant).

## Project structure (what to edit)

- **Main logic**: `main.c`
- **SPI packet transport**: `spi.c`, `spi.h`
- **Shared error codes**: `common.h`
- **MCC-generated peripherals**: `mcc_generated_files/` (do not hand-edit; generated by Microchip Code Configurator)
- **Hardware-trigger variant**:
  - `main_hardware_trigger.c` and `interrupt_manager_hardware_trigger.c` (alternative implementation for trigger-on-T1G)

### Source vs generated artifacts

- `mcc_generated_files/`: generated
- `build/`, `dist/`: build outputs (if present). Example: `dist/PICkit3/production/*.hex` is a typical production output.

## Build and flash (MPLAB X)

Typical workflow:
1. Open the `strobe_pic` project folder in **MPLAB X IDE**.
2. Select the appropriate configuration (e.g., PICkit3/PICkit4) under project properties.
3. Build/flash using your PIC programmer.

Toolchain and exact device are defined by the MPLAB project configuration; `main.c` includes `<pic16f18856.h>`.

## SPI interface (host protocol)

### Packet framing

`spi_packet_read()` documents the framing used by this firmware:
- `[STX=2][size][packet_type][data...][checksum]`
- The checksum is computed so that the sum over `(STX + size + packet_type + data bytes + checksum)` equals 0 modulo 256.

### Packet types (from `main.c`)

- `1` **SET_STROBE_ENABLE**: enable/disable strobe output
- `2` **SET_STROBE_TIMING**: set strobe timing parameters
- `3` **SET_STROBE_HOLD**: hold/unhold behavior
- `4` **GET_CAM_READ_TIME**: request measured camera read-time (Âµs)

Payload formats are defined in `main.c` (see packet handling switch) and should be treated as the source-of-truth for the host-side driver.

## Compatibility notes

- The repository supports different strobe control modes (strobe-centric vs camera-centric) on the host side. Ensure the host configuration and firmware variant match the intended control mode.
- If you switch to the hardware-trigger variant, ensure the corresponding interrupt handling (`interrupt_manager_hardware_trigger.c`) and the expected trigger pin wiring are in place.


