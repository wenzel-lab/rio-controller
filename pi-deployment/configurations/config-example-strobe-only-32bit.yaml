# Rio Controller Configuration
# Pre-configuration: Strobe Only (32-bit) with Droplet Detection
#
# This configuration is for a Raspberry Pi running 32-bit Raspberry Pi OS
# with only the strobe module and camera connected. Droplet detection is enabled.
# Uses strobe-centric control mode compatible with firmware that supports
# software trigger mode.
#
# IMPORTANT: This mode works only on 32-bit Raspberry Pi OS because it requires
# the picamera package, which is 32-bit only.
#
# Usage:
#   1. Set environment variables (see below)
#   2. Run: python main.py
#
# Environment Variables (required):
#   export RIO_STROBE_CONTROL_MODE=strobe-centric
#   export RIO_SIMULATION=false
#   export RIO_DROPLET_ANALYSIS_ENABLED=true
#   export RIO_FLOW_ENABLED=false      # Hide flow control tab (not used in this config)
#   export RIO_HEATER_ENABLED=false    # Hide heater tab (not used in this config)

# Global simulation mode
# Set to false for hardware operation
simulation: false

# Camera configuration (32-bit Raspberry Pi Camera V2)
# Camera sensor: Sony IMX219, 3280 × 2464 pixels (8 megapixels)
# https://www.raspberrypi.com/documentation/accessories/camera.html#camera-module-2
camera:
  type: rpi              # Use "rpi" for 32-bit Pi Camera V2 (picamera package)
  # NOTE: Display resolution can now be adjusted via the web interface UI
  # Default resolution shown below (1024×768), can be changed in Camera Configuration tab
  # Available presets: 640×480, 800×600, 1024×768, 1280×960, 1920×1080
  # Full sensor resolution (3280×2464) available for snapshots via UI
  width: 1024            # Default display width (can be changed in UI)
  height: 768            # Default display height (can be changed in UI)
  fps: 30                # Default framerate (automatically optimized via strobe timing)

# Strobe configuration (strobe-centric control mode)
strobe:
  port: 24               # SPI device select port (GPIO pin 24, BOARD numbering)
  reply_pause_s: 0.1     # SPI reply pause time (100ms delay for PIC microcontroller to process commands)
  control_mode: strobe-centric  # Strobe-centric control (software trigger)
  trigger_gpio_pin: 18   # GPIO pin for trigger signal (BCM numbering, optional in strobe-centric mode)
  default_period_ns: 100000      # Default strobe pulse period (100 microseconds)
  max_period_ns: 16000000        # Maximum strobe pulse period (16 milliseconds)
  pre_padding_ns: 32             # Pre-padding before strobe pulse
  post_padding_ns: 20000000      # Post-padding after strobe pulse
  # Strobe-centric mode: Strobe timing controls camera exposure
  # Camera framerate is automatically calculated and optimized from strobe timing
  # Use the "Optimize" button in the web interface to fine-tune framerate

# Droplet detection (enabled)
droplet_detection:
  enabled: true          # Enable droplet detection and analysis
  # Droplet detection provides:
  #   - Real-time droplet counting
  #   - Size measurement
  #   - Histogram generation
  #   - ROI (Region of Interest) selection via web interface
  # Requires: numpy, opencv-python
  # Processing uses ROI coordinates selected via web interface

# SPI configuration
spi:
  bus: 0                 # SPI bus number (SPI0 on Raspberry Pi)
  mode: 2                # SPI mode (clock polarity and phase)
  speed_hz: 30000        # SPI communication speed (30 kHz - slow for reliable PIC communication)
  # SPI ports (GPIO pins used for device selection, BOARD numbering):
  #   - Strobe: Port 24
  #   Note: Flow controller and heaters are not used in this configuration

# Notes:
# - Firmware requirement: Must use firmware compatible with software trigger mode (strobe-centric)
# - Camera must be enabled: sudo raspi-config -> Interface Options -> Camera -> Enable
# - Test camera: raspistill -o test.jpg
# - SPI must be enabled: sudo raspi-config -> Interface Options -> SPI -> Enable
# - Resolution and framerate:
#   * Display resolution: Adjustable via web interface (Camera Configuration tab)
#   * Snapshot resolution: Selectable via web interface (display or full sensor resolution)
#   * Framerate: Automatically calculated from strobe timing, optimized via "Optimize" button
# - Reply pause (0.1s) gives PIC time to process commands; limits SPI to ~10 commands/second
#   which is sufficient for configuration and status updates
